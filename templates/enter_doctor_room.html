<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Video Call</title>
</head>
<body>

<!-- Seus outros elementos HTML vão aqui -->

<script>
    // Suponha que a variável 'answer' contém a resposta SDP renderizada pelo Jinja2
    const answer = {{ answer | tojson | safe }};
    const sessionId = '{{ session_id }}';

    // Suponha que 'peerConnection' é a sua conexão RTCPeerConnection já estabelecida anteriormente
    const peerConnection = new RTCPeerConnection();

    // Aqui você define a descrição remota usando a resposta recebida do cliente 2
    peerConnection.setRemoteDescription(new RTCSessionDescription(answer))
    .then(() => {
        console.log("Descrição remota configurada com sucesso.");
        // A descrição remota foi configurada com sucesso, agora você pode continuar com o processo
        // Talvez iniciar a coleta de candidatos ICE ou esperar por streams, dependendo do seu fluxo de sinalização
    })
    .catch(error => {
        console.error("Falha ao configurar a descrição remota: ", error);
    });



    // Aqui você pode adicionar o resto do seu código para manipular eventos de candidatos ICE e fluxos de mídia

    async function sendIceCandidate(sessionId, candidate) {
        const response = await fetch('/ice-candidate', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            // Incluir o session_id no corpo da requisição
            body: JSON.stringify({ session_id: sessionId, candidate: candidate })
        });
        if (!response.ok) {
            throw new Error(`Failed to send ICE candidate: ${response.statusText}`);
        }
    }

    peerConnection.onicecandidate = async (event) => {
        if (event.candidate) {
            try {
                // Passar o session_id para a função sendIceCandidate
                await sendIceCandidate(sessionId, event.candidate);
            } catch (error) {
                console.error('Failed to send ICE candidate:', error);
            }
        }
    };

</script>

</body>
</html>
